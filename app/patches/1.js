// Generated by CoffeeScript 1.8.0
var fs, me, modelFolder, path;

me = require('mongo-ember');

fs = require('fs');

path = require('path');

modelFolder = path.resolve('../models');

me.loadModels(modelFolder);

me.connect({}, 'mongodb://localhost/ti', function(app) {
  var Log, Question;
  Question = me.getModel('Question');
  Log = me.getModel('Log');
  return Question.find({}, function(err, questions) {
    var question, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = questions.length; _i < _len; _i++) {
      question = questions[_i];
      _results.push((function(question) {
        var query;
        query = {};
        query['target'] = 'question';
        query['data.question._id'] = question._id;
        return Log.find(query).sort('-date').limit(1).populate('user').exec(function(err, result) {
          var time, username;
          if (err) {
            return console.log(err);
          } else if ((result != null) && result.length > 0) {
            result = result[0];
            username = result.user.username;
            time = result._id.getTimestamp();
            question.lastEditor = username;
            question.lastModifiedTime = time;
            question.questionLastEditor = username;
            question.questionLastModifiedTime = time;
            question.solutionLastEditor = username;
            question.solutionLastModifiedTime = time;
            question.hintLastEditor = username;
            question.hintLastModifiedTime = time;
            question.summaryLastEditor = username;
            question.summaryLastModifiedTime = time;
            return question.save();
          } else {

          }
        });
      })(question));
    }
    return _results;
  });
});
