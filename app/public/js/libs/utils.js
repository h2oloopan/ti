// Generated by CoffeeScript 1.7.1
define(['jquery', 'bootstrap-wysiwyg'], function($) {
  var utils;
  return utils = {
    createMathEditor: function(input, preview) {
      var MathEditor;
      MathEditor = (function() {
        function MathEditor(input, preview) {
          this.input = input;
          this.preview = preview;
          this.init();
        }

        MathEditor.prototype.delay = 300;

        MathEditor.prototype.timeout = null;

        MathEditor.prototype.running = false;

        MathEditor.prototype.init = function() {
          var thiz;
          thiz = this;
          $(this.input).wysiwyg();
          $(this.input).on('keypress', function() {
            return thiz.update();
          });
          return $(this.input).on('paste', function(e) {
            var content;
            e.preventDefault();
            if (e.originalEvent.clipboardData) {
              content = (e.originalEvent || e).clipboardData.getData('text/plain');
              return document.execCommand('insertText', false, content);
            } else if (window.clipboardData) {
              content = window.clipboardData.getData('Text');
              return document.selection.createRange().pasteHTML(content);
            }
          });
        };

        MathEditor.prototype.update = function() {
          var thiz;
          thiz = this;
          if (this.timeout) {
            clearTimeout(this.timeout);
          }
          return this.timeout = setTimeout(function() {
            var content;
            if (thiz.running) {
              return;
            }
            content = $(thiz.input).html();
            $(thiz.preview).html(content);
            thiz.running = true;
            return MathJax.Hub.Queue(['Typeset', MathJax.Hub, $(thiz.preview)[0]], ['done', thiz]);
          }, this.delay);
        };

        MathEditor.prototype.done = function() {
          return this.running = false;
        };

        return MathEditor;

      })();
      return new MathEditor(input, preview);
    }
  };
});
