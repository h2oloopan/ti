define(["jquery","me","utils","js/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML","ehbs!templates/questions/question.edit","ehbs!templates/questions/questions.index","ehbs!templates/questions/questions.new"],function(e,t,n){var o;return o={setup:function(o){return o.Router.map(function(){return this.resource("questions",function(){return this.route("new")}),this.resource("question",{path:"/question/:question_id"},function(){return this.route("edit")})}),o.QuestionsRoute=Ember.Route.extend({beforeModel:function(){var e;return e=this,t.auth.check().then(function(t){return null==t?e.transitionTo("login"):void 0},function(){return this.fail,e.transitionTo("login")})}}),o.QuestionRoute=Ember.Route.extend({beforeModel:function(){var e;return e=this,t.auth.check().then(function(t){return null==t?e.transitionTo("login"):void 0},function(){return this.fail,e.transitionTo("login")})}}),o.QuestionEditRoute=Ember.Route.extend({model:function(){var e,t;return t=this,e=this.modelFor("question").id,new Ember.RSVP.Promise(function(n,o){return new Ember.RSVP.hash({question_real:t.store.find("question",e),question_fake:t.store.createRecord("question",{}),schools:t.store.find("school")}).then(function(e){return n({question_real:e.question_real,question_fake:e.question_fake,schools:e.schools})},function(e){return o(e)})})},afterModel:function(e){var t,n,o,i,s,r,u,a,c,l,h,f,m,d,q,p,b,g;for(i=e.question_real,o=e.question_fake,o.set("school",i.get("school")),r=o.get("school").toJSON(),i.eachAttribute(function(e){return o.set(e,i.get(e))}),o.set("id",i.get("id")),o.set("initialize",{subject:!0,term:!0,course:!0}),u=r.info.subjects[0],p=r.info.subjects,l=0,m=p.length;m>l;l++)if(s=p[l],s.code===i.get("subject")){u=s;break}for(o.set("subject",u),c=u.terms[0],b=u.terms,h=0,d=b.length;d>h;h++)if(a=b[h],a.name===i.get("term")){c=a;break}for(o.set("term",c),n=c.courses[0],g=c.courses,f=0,q=g.length;q>f;f++)if(t=g[f],t.number===i.get("course")){n=t;break}return o.set("course",n)}}),o.QuestionEditView=Ember.View.extend({didInsertElement:function(){var t,o,i,s;return this._super(),o=n.createMathEditor(e("#question-input"),e("#question-preview")),t=n.createMathEditor(e("#hint-input"),e("#hint-preview")),i=n.createMathEditor(e("#solution-input"),e("#solution-preview")),s=n.createMathEditor(e("#summary-input"),e("#summary-preview")),o.update(),t.update(),i.update(),s.update()}}),o.QuestionEditController=Ember.ObjectController.extend({types:["other","assignment","midterm","final","textbook"],difficulties:[1,2,3,4,5],subjects:function(){var e;return e=this.get("question_fake.school"),null==e?[]:(this.get("question_fake.initialize.subject")?this.set("question_fake.initialize.subject",!1):this.set("question_fake.subject",e.toJSON().info.subjects[0]),e.toJSON().info.subjects)}.property("question_fake.school"),terms:function(){var e;return e=this.get("question_fake.subject"),null==e?[]:(this.get("question_fake.initialize.term")?this.set("question_fake.initialize.term",!1):this.set("question_fake.term",e.terms[0]),e.terms)}.property("question_fake.subject"),courses:function(){var e;return e=this.get("question_fake.term"),null==e?[]:(this.get("question_fake.initialize.course")?this.set("question_fake.initialize.course",!1):this.set("question_fake.course",e.courses[0]),e.courses)}.property("question_fake.term"),prepare:function(t){var n;return n=t.toJSON(),n.subject=t.get("subject.code"),n.term=t.get("term.name"),n.course=t.get("course.number"),n.question=e("#question-input").html(),n.hint=e("#hint-input").html(),n.solution=e("#solution-input").html(),n.summary=e("#summary-input").html(),null==t.get("difficulty")&&(n.difficulty=0),n=this.store.createRecord("Question",n),n.set("school",t.get("school"))},actions:{save:function(){var e,t,n,o;return o=this,t=this.prepare(this.get("question_fake")),n=t.validate(),this.set("question_fake.errors",t.errors),n?(e=this.get("question_real"),e.eachAttribute(function(n){return e.set(n,t.get(n))}),e.save().then(function(){return o.transitionToRoute("questions")},function(t){return e.rollback,console.log(t),alert(t)}),!1):!1}}}),o.QuestionsIndexRoute=Ember.Route.extend({model:function(){return this.store.find("question")}}),o.QuestionsIndexController=Ember.ArrayController.extend({sortProperties:["id"],sortAscending:!1,preview:{},itemController:"questionItem"}),o.QuestionItemController=Ember.ObjectController.extend({isHidden:function(){return this.get("flag")>0?!1:!0}.property("flag"),needs:"questionsIndex",actions:{"delete":function(e){var t,n;return n=e.get("school.name")+" "+e.get("term")+" "+e.get("subject")+" "+e.get("course"),t=confirm("Do you want to delete question "+e.get("id")+" of "+n+"?"),t&&(e.set("flag",0),e.save().then(function(){return!0},function(t){return e.rollback(),alert(t.responseText)})),!1},view:function(t){var n,o,i,s;return this.set("controllers.questionsIndex.preview",t),t=t.toJSON(),o=e("#question-view").html(t.question),n=e("#hint-view").html(t.hint),i=e("#solution-view").html(t.solution),s=e("#summary-view").html(t.summary),MathJax.Hub.Queue(["Typeset",MathJax.Hub,e("#modal-math")[0]]),e(".modal").modal(),!1}}}),o.QuestionsNewRoute=Ember.Route.extend({model:function(){var e;return e=this,new Ember.RSVP.Promise(function(t,n){return new Ember.RSVP.hash({question:e.store.createRecord("question",{}),schools:e.store.find("school")}).then(function(e){return t({question:e.question,schools:e.schools})},function(e){return n(e)})})}}),o.QuestionsNewView=Ember.View.extend({didInsertElement:function(){var t,o,i,s;return this._super(),o=n.createMathEditor(e("#question-input"),e("#question-preview")),t=n.createMathEditor(e("#hint-input"),e("#hint-preview")),i=n.createMathEditor(e("#solution-input"),e("#solution-preview")),s=n.createMathEditor(e("#summary-input"),e("#summary-preview"))}}),o.QuestionsNewController=Ember.ObjectController.extend({types:["other","assignment","midterm","final","textbook"],difficulties:[1,2,3,4,5],subjects:function(){var e;return e=this.get("question.school"),null==e?[]:(this.set("question.subject",e.toJSON().info.subjects[0]),e.toJSON().info.subjects)}.property("question.school"),terms:function(){var e;return e=this.get("question.subject"),null==e?[]:(this.set("question.term",e.terms[0]),e.terms)}.property("question.subject"),courses:function(){var e;return e=this.get("question.term"),null==e?[]:(this.set("question.course",e.courses[0]),e.courses)}.property("question.term"),prepare:function(t){var n;return n=t.toJSON(),n.subject=t.get("subject.code"),n.term=t.get("term.name"),n.course=t.get("course.number"),n.question=e("#question-input").html(),n.hint=e("#hint-input").html(),n.solution=e("#solution-input").html(),n.summary=e("#summary-input").html(),null==t.get("difficulty")&&(n.difficulty=0),n=this.store.createRecord("Question",n),n.set("school",t.get("school")),n},actions:{add:function(){var e,t,n;return n=this,e=this.prepare(this.get("question")),t=e.validate(),this.set("question.errors",e.errors),t?(e.save().then(function(){return n.transitionToRoute("questions")},function(t){return e.rollback(),console.log(t),alert(t)}),!1):!1}}})}}});