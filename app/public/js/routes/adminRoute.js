define(["jquery","me","utils","ehbs!templates/admin/admin","ehbs!templates/admin/users","ehbs!templates/admin/users.new","ehbs!templates/admin/users.edit","ehbs!templates/admin/tests","ehbs!templates/admin/schools","ehbs!templates/admin/school.edit","ehbs!templates/admin/console"],function(e,t){var r;return r={setup:function(r){return r.Router.map(function(){return this.route("admin")}),r.AdminRoute=Ember.Route.extend({beforeModel:function(){var e;return e=this,t.auth.power(999).then(function(){return!0},function(){return e.transitionTo("error",{type:"401"})})},model:function(){var e;return e=this,new Ember.RSVP.Promise(function(t,r){return new Ember.RSVP.hash({users:e.store.find("user"),schools:e.store.find("school")}).then(function(e){return t({users:e.users,schools:e.schools})},function(e){return r(e)})})}}),r.AdminController=Ember.ObjectController.extend({actions:{deleteQuestionPhoto:function(){return e.ajax({url:"/api/images/temp",type:"DELETE"}).done(function(){return!1}).fail(function(e){return alert(e.responseText)}),!1}}}),r.AdminView=Ember.View.extend({didInsertElement:function(){var t;return this._super(),e(".nav-tabs a").each(function(){return e(this).click(function(t){var r,n,s;return s=t.currentTarget,n=e(s).attr("href").substr(1),r=window.location.href,r.indexOf("?")>=0&&(r=r.substr(0,r.indexOf("?"))),window.location.href=r+"?"+n})}),t=window.location.href,t=t.indexOf("?")>=0?"#"+t.substr(t.indexOf("?")+1):null,null!=t?e('.nav-tabs a[href="'+t+'"]').click():e(".nav-tabs a:first").click()}}),r.UsersController=Ember.ArrayController.extend({sortProperties:["power"],sortAscending:!1,itemController:"user",actions:{add:function(){return e(".modal-admin-user").modal()}}}),r.UserController=Ember.ObjectController.extend({needs:"usersEdit",isAdmin:function(){return this.get("model.power")>=999?!0:!1}.property("power"),type:function(){}.property("power"),actions:{edit:function(t){var r;return r=this,t.set("password",null),this.store.find("school").then(function(n){return r.set("controllers.usersEdit.model",{user:t,schools:n}),e(".modal-admin-user-edit").modal(),!0},function(){return!1}),!1},"delete":function(e){var t;return t=confirm("Do you want to delete user "+e.get("username")+"?"),t&&e.destroyRecord().then(function(){return!0},function(t){return e.rollback(),alert(t.responseText)}),!1}}}),Ember.Handlebars.helper("school",function(){return new Ember.Handlebars}),r.UsersEditController=Ember.ObjectController.extend({roles:["editor","instructor"],errors:{},isAddingPrivilege:!1,schoolChanged:function(){var e,t,r,n,s;if(this.get("user")){for(t=this.get("user.privileges"),s=[],r=0,n=t.length;n>r;r++)e=t[r],s.push(this.store.find("school",e.school).then(function(t){return e.schoolDisplay=t.get("name"),!0},function(){return!1}));return s}}.observes("user"),cleanPrivilege:function(){return this.set("subject",null),this.set("course",null)},actions:{addPrivilege:function(){return this.set("isAddingPrivilege",!0),!1},savePrivilege:function(){var e,r;return null==this.get("school")&&t.isEmptyString(this.get("subject"))&&t.isEmptyString(this.get("course"))?(alert("Cannot enter an empty row of privilege"),!1):t.isEmptyString(this.get("subject"))&&!t.isEmptyString(this.get("course"))?(alert("Course must be coupled with subject"),!1):(r=this.get("user"),e=r.get("privileges"),e.pushObject({school:this.get("school"),subject:this.get("subject"),course:this.get("course")}),r.set("privileges",e),this.cleanPrivilege(),this.set("isAddingPrivilege",!1),!1)},cancelPrivilege:function(){return this.cleanPrivilege(),this.set("isAddingPrivilege",!1),!1},deletePrivilege:function(e){var t;return t=this.get("user.privileges"),t.removeObject(e),this.set("user.privileges",t),!1},save:function(r){var n,s,o,i,u;for(o=r.validate(),s=t.keys(r.errors),i=0,u=s.length;u>i;i++)if(n=s[i],"password"!==n)return this.set("errors."+n,errors[n]),!1;return r.save().then(function(){return e(".modal-admin-user-edit").modal("hide")},function(e){return r.rollback(),alert(e.responseText)}),!1}}}),r.UsersNewController=Ember.ObjectController.extend({user:{role:{}},roles:["editor","instructor"],prepare:function(e){return e},actions:{add:function(){var t,r;return this.set("user.errors",null),r=this.store.createRecord("user",this.get("user")),(t=r.validate())?(r.save().then(function(){return e(".modal-admin-user").modal("hide")},function(e){return r.rollback(),alert(e.responseText)}),!1):(this.set("user.errors",r.errors),!1)}}}),r.ConsoleController=Ember.ObjectController.extend({url:"",stuff:"",result:"",actions:{post:function(){var t,r,n;return r=this,n=this.get("url"),t=this.get("stuff"),t=JSON.parse(t.trim()),e.ajax({type:"POST",url:n,data:JSON.stringify(t),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){return r.set("result",e),!0}).fail(function(e){return r.set("result",e.responseText),!1}),!1}}}),r.SchoolsController=Ember.ArrayController.extend({school:{},itemController:"school",actions:{add:function(){return this.set("school.errors",null),this.set("isAdding",!0),!1},save:function(e){var t,r;return r=this,e=this.store.createRecord("school",e),(t=e.validate())?(e.save().then(function(){return r.set("school.name",null),r.set("isAdding",!1)},function(t){return e.rollback(),alert(t.responseText)}),!1):(this.set("school.errors",e.errors),!1)},cancel:function(){return this.set("school.name",null),this.set("isAdding",!1),!1}}}),r.SchoolController=Ember.ObjectController.extend({needs:"schools",needs:"schoolEdit",schoolEdit:Ember.computed.alias("controllers.schoolEdit"),actions:{select:function(t){var r;return r=t.get("id"),e(".nav-sidebar li").removeClass("active"),e('.nav-sidebar li[data-id="'+r+'"]').addClass("active"),this.get("schoolEdit").send("update",t)}}}),r.SchoolEditController=Ember.ObjectController.extend({actions:{update:function(e){return this.set("model",e),this.set("isEditing",!0),this.get("info.subjects").length>0?this.set("selectedSubject",this.get("info.subjects")[0]):void 0},deleteSchool:function(){return alert("We are not allowed to delete school at the moment"),!1},addSubject:function(){return this.set("isAddingSubject",!0),!1},cancelSubject:function(){return this.set("subject",null),this.set("isAddingSubject",!1),!1},saveSubject:function(e){var t,r,n,s;return s=this,t=this.get("info"),r=function(t){return t.name.toLowerCase()===e.toLowerCase()?!0:!1},t.subjects.any(r)?(alert("You cannot add subject with same name"),!1):(t.subjects.pushObject({name:e,courses:[]}),this.set("subject",null),this.set("isAddingSubject",!1),n=this.get("model"),n.save().then(function(){var e;return e=n.get("info.subjects"),0===e.length?!0:(s.set("selectedSubject",e[e.length-1]),!0)},function(e){return n.rollback(),alert(e.responseText),!1}),!1)},deleteSubject:function(e){var t,r,n,s;return s=this,(t=confirm("Are you sure you want to delete subject "+e.name+"?"))?(r=this.get("info"),r.subjects.removeObject(e),n=this.get("model"),n.save().then(function(){var e;return e=n.get("info.subjects"),0===e.length?!0:(s.set("selectedSubject",e[e.length-1]),!0)},function(e){return n.rollback(),alert(e.responseText)}),!1):!1},addCourse:function(){return this.set("isAddingCourse",!0),!1},cancelCourse:function(){return this.set("course",null),this.set("isAddingCourse",!1),!1},saveCourse:function(e){var t,r,n,s;return s=this,n=this.get("selectedSubject"),t=function(t){return t.number.toLowerCase()===e.toLowerCase()?!0:!1},n.courses.any(t)?(alert("You cannot add course with same name/number"),!1):(n.courses.pushObject({number:e,name:""}),this.set("course",null),this.set("isAddingCourse",!1),r=this.get("model"),r.save().then(function(){var e;return e=r.get("info.subjects").find(function(e){return e.name===n.name?!0:!1}),null==e?!0:(s.set("selectedSubject",e),!0)},function(e){return r.rollback(),alert(e.responseText),!1}),!1)},deleteCourse:function(e){var t,r,n,s;return s=this,(t=confirm("Are you sure you want to delete course "+e.number+"?"))?(n=this.get("selectedSubject"),n.courses.removeObject(e),r=this.get("model"),r.save().then(function(){var e;return e=r.get("info.subjects").find(function(e){return e.name===n.name?!0:!1}),null==e?!0:(s.set("selectedSubject",e),!0)},function(e){return r.rollback(),alert(e.responseText)}),!1):!1},addType:function(){return this.set("isAddingType",!0),!1},cancelType:function(){return this.set("type",null),this.set("isAddingType",!1),!1},saveType:function(e){var t,r,n,s;return n=this,s=this.get("types"),t=function(t){return t.toLowerCase()===e.toLowerCase()?!0:!1},s.any(t)?(alert("You cannot add type with same name"),!1):(s.pushObject(e),this.set("type",null),this.set("isAddingType",!1),r=this.get("model"),r.save().then(function(){return!0},function(e){return r.rollback(),alert(e.responseText),!1}))},deleteType:function(e){var t,r,n,s;return n=this,(t=confirm("Are you sure you want to delete type "+e+"?"))?(s=this.get("types"),s.removeObject(e),r=this.get("model"),r.save().then(function(){return!0},function(e){return r.rollback(),alert(e.responseText),!1})):!1},addTerm:function(){return this.set("isAddingTerm",!0),!1},cancelTerm:function(){return this.set("term",null),this.set("isAddingTerm",!1),!1},saveTerm:function(e){var t,r,n,s;return s=this,n=this.get("terms"),t=function(t){return t.toLowerCase()===e.toLowerCase()?!0:!1},n.any(t)?(alert("You cannot add term with same name"),!1):(n.pushObject(e),this.set("term",null),this.set("isAddingTerm",!1),r=this.get("model"),r.save().then(function(){return!0},function(e){return r.rollback(),alert(e.responseText),!1}))},deleteTerm:function(e){var t,r,n,s;return s=this,(t=confirm("Are you sure you want to delete term "+e+"?"))?(n=this.get("terms"),n.removeObject(e),r=this.get("model"),r.save().then(function(){return!0},function(e){return r.rollback(),alert(e.responseText),!1})):!1}}})}}});