// Generated by CoffeeScript 1.7.1
var Schema, me, moment;

me = require('mongo-ember');

moment = require('moment');

Schema = me.Schema;

module.exports = {
  Test: {
    schema: {
      name: {
        type: String,
        required: true
      },
      questions: {
        type: [Schema.Types.Mixed],
        "default": []
      },
      note: {
        type: String,
        "default": ''
      },
      "public": {
        type: Boolean,
        "default": false
      },
      school: {
        type: Schema.Types.ObjectId,
        ref: 'School',
        required: true
      },
      subject: {
        type: String,
        required: true
      },
      course: {
        type: String,
        required: true
      },
      creator: {
        type: Schema.Types.ObjectId,
        ref: 'User'
      },
      createdTime: {
        type: Date,
        "default": null
      },
      lastModifiedTime: {
        type: Date,
        "default": null
      }
    },
    validationMessages: {
      name: {
        required: 'Name cannot be empty'
      },
      school: {
        required: 'School cannot be empty'
      },
      subject: {
        required: 'subject cannot be empty'
      },
      course: {
        required: 'course cannot be empty'
      }
    },
    before: {
      c: function(test, user, cb) {
        var question, time, _i, _len, _ref;
        if (user == null) {
          return cb(new Error('No user is present'));
        }
        time = moment().toDate();
        test.creator = me.ObjectId(user._id);
        test.createdTime = time;
        test.lastModifiedTime = time;
        _ref = test.questions;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          question = _ref[_i];
          question._id = me.ObjectId(question._id);
          question.editor = me.ObjectId(question.editor);
          question.school = me.ObjectId(question.school);
        }
        return cb(null, test);
      }
    }
  }
};
